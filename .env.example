# MAAS Docker Compose Environment Variables
# Copy this file to .env and configure with your settings
# DO NOT commit .env file to version control - it contains sensitive data

# =============================================================================
# REQUIRED VARIABLES
# =============================================================================

# MAAS Server Configuration
# Full URL where MAAS will be accessible (must be reachable by managed machines)
# Examples:
#   - http://192.168.1.100:5240/MAAS
#   - http://truenas.local:5240/MAAS
#   - https://maas.example.com/MAAS
MAAS_URL=http://192.168.1.100:5240/MAAS

# MAAS Administrator Credentials
# Password must be at least 8 characters (16+ recommended)
MAAS_ADMIN_USERNAME=admin
MAAS_ADMIN_PASSWORD=changeme-secure-password
MAAS_ADMIN_EMAIL=admin@example.com

# PostgreSQL Database Configuration
# Password must be at least 8 characters (16+ recommended)
POSTGRES_PASSWORD=changeme-database-password

# =============================================================================
# OPTIONAL VARIABLES (with defaults)
# =============================================================================

# Docker Image Configuration
# IMAGE_REPOSITORY=maasio/maas
# IMAGE_TAG=3.5

# Network Configuration
# Options: host (recommended for PXE boot) or bridge (isolated network)
# NETWORK_MODE=host

# Port Mappings (only used in bridge mode)
# MAAS_HTTP_PORT=5240
# MAAS_HTTPS_PORT=5443
# TFTP_PORT=69
# PROXY_PORT=8000

# Timezone
# TZ=Etc/UTC
# TZ=America/New_York
# TZ=Europe/London

# PostgreSQL Configuration
# POSTGRES_DB=maasdb
# POSTGRES_USER=maas
# POSTGRES_HOST=postgres
# POSTGRES_PORT=5432

# PostgreSQL Image Configuration (custom build for TrueNAS uid/gid 1000)
# POSTGRES_IMAGE_REPOSITORY=truenas-maas-postgres
# POSTGRES_IMAGE_TAG=15

# PostgreSQL Performance Tuning
# Initialization arguments (advanced users only)
# POSTGRES_INITDB_ARGS=-E UTF8 --locale=C

# PostgreSQL Memory Configuration
# These are configured in docker/postgresql.conf but can be overridden
# POSTGRES_SHARED_BUFFERS=2GB        # 25% of available RAM
# POSTGRES_EFFECTIVE_CACHE_SIZE=6GB  # 50-75% of available RAM
# POSTGRES_WORK_MEM=20MB             # For sort/hash operations
# POSTGRES_MAINTENANCE_WORK_MEM=512MB # For VACUUM, CREATE INDEX

# MAAS Advanced Configuration
# MAAS_REGION_SECRET=
# MAAS_DEBUG=false
# MAAS_DNS_FORWARDER=8.8.8.8
# MAAS_UPSTREAM_DNS=8.8.8.8 8.8.4.4
# MAAS_BOOT_IMAGES_AUTO_IMPORT=true

# =============================================================================
# STORAGE PATHS
# =============================================================================

# Host path volumes (TrueNAS datasets recommended)
# All paths should exist and be owned by uid/gid 1000
# Create with: mkdir -p /mnt/tank/maas/{config,data,images,logs,tmp,postgres}
#              chown -R 1000:1000 /mnt/tank/maas/

# MAAS configuration files (~100MB)
MAAS_CONFIG_PATH=/mnt/tank/maas/config

# MAAS application data (~10GB minimum)
MAAS_DATA_PATH=/mnt/tank/maas/data

# Boot images for OS deployment (100GB+ recommended)
MAAS_IMAGES_PATH=/mnt/tank/maas/images

# Log files (5GB recommended)
MAAS_LOGS_PATH=/mnt/tank/maas/logs

# Temporary files
MAAS_TMP_PATH=/mnt/tank/maas/tmp

# PostgreSQL database (20GB minimum)
POSTGRES_DATA_PATH=/mnt/tank/maas/postgres

# =============================================================================
# STORAGE REQUIREMENTS SUMMARY
# =============================================================================
# Config:     ~100MB
# Data:       ~10GB minimum
# Images:     100GB+ (depends on number of OS images)
# Logs:       5GB recommended
# Temp:       1GB recommended
# PostgreSQL: 20GB minimum
# ---------------------------
# Total:      ~135GB minimum

# =============================================================================
# QUICK START
# =============================================================================
#
# 1. Copy this file to .env:
#    cp .env.example .env
#
# 2. Edit .env and set required variables:
#    - MAAS_URL (must be accessible from managed machines)
#    - MAAS_ADMIN_PASSWORD (use strong password)
#    - MAAS_ADMIN_EMAIL (your email)
#    - POSTGRES_PASSWORD (use strong password)
#
# 3. Create storage directories:
#    mkdir -p /mnt/tank/maas/{config,data,images,logs,tmp,postgres}
#    chown -R 1000:1000 /mnt/tank/maas/
#    chmod -R 755 /mnt/tank/maas/
#
# 4. Start services:
#    docker compose up -d
#
# 5. Monitor logs:
#    docker compose logs -f maas
#
# 6. Access MAAS UI:
#    http://<truenas-ip>:5240/MAAS
#
# =============================================================================
# NETWORK MODE SELECTION
# =============================================================================
#
# Host Mode (Recommended for Production):
#   - Required for PXE boot and DHCP functionality
#   - Direct access to host network
#   - Set NETWORK_MODE=host
#   - MAAS will use default ports (5240, 69, etc.) directly on host
#
# Bridge Mode (Testing/API-only):
#   - Isolated network with port mapping
#   - No PXE boot capability
#   - Set NETWORK_MODE=bridge
#   - Configure port mappings as needed
#
# =============================================================================
# SECURITY RECOMMENDATIONS
# =============================================================================
#
# 1. Use strong, unique passwords:
#    - Minimum 16 characters
#    - Mix of uppercase, lowercase, numbers, symbols
#    - Generate with: openssl rand -base64 32
#
# 2. Protect .env file:
#    chmod 600 .env
#
# 3. Never commit .env to version control:
#    Add to .gitignore
#
# 4. Regularly update passwords
#
# 5. Enable HTTPS in production:
#    - Use reverse proxy (nginx, traefik)
#    - Obtain valid TLS certificates
#
# 6. Restrict network access:
#    - Use firewall rules
#    - Limit access to private networks
#    - Consider VPN for remote access
#
# =============================================================================
# TROUBLESHOOTING
# =============================================================================
#
# Services won't start:
#   - Check logs: docker compose logs
#   - Verify .env variables are set correctly
#   - Ensure storage paths exist and have correct permissions
#   - Check for port conflicts: netstat -tuln | grep -E '5240|69'
#
# Database connection errors:
#   - Check PostgreSQL logs: docker compose logs postgres
#   - Verify POSTGRES_PASSWORD matches in both services
#   - Ensure postgres service is healthy: docker compose ps
#
# PXE boot not working:
#   - Ensure NETWORK_MODE=host
#   - Verify TFTP port 69/UDP is accessible
#   - Check firewall rules allow TFTP traffic
#   - Confirm MAAS has NET_ADMIN and NET_RAW capabilities
#
# Permission denied errors:
#   - Verify directories owned by uid/gid 1000:
#     ls -la /mnt/tank/maas/
#   - Fix ownership:
#     chown -R 1000:1000 /mnt/tank/maas/
#
# Out of space errors:
#   - Check available space: df -h /mnt/tank/
#   - Allocate more space for images (100GB+ recommended)
#   - Clean up old boot images via MAAS UI
#
# =============================================================================
